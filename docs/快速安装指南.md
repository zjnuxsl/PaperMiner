PaperMiner - 完整安装指南

**PaperMiner**: 智能论文内容提取工具

## 📋 系统要求

### 硬件要求

- **操作系统**: Windows 10/11
- **内存**: 8GB+（CPU 模式建议 16GB+）
- **存储**: 至少 5GB 可用空间（模型约2GB）
- **显卡**（可选）: NVIDIA GPU（支持CUDA加速）

### 软件要求

- **Python**: 3.10-3.13（推荐 3.12）
- **Conda**: Anaconda 或 Miniconda
- **网络**（首次安装）: 用于下载依赖和模型

提示（Conda 安装路径与环境变量）：

- 安装路径不受限，可装在 C: 或 D: 等任意磁盘（例如 `D:\miniconda3`）。
- 一般无需手动配置系统“全局变量”。确保在普通 CMD 中执行 `conda --version` 可用即可。
- 若 `conda` 在 CMD 不可用，任选其一：
  - 通过“Anaconda Prompt”运行本项目；或
  - 在 CMD 执行 `conda init cmd.exe` 后重启终端；或
  - 将 `<安装目录>\condabin` 加入系统 `PATH`（如 `D:\miniconda3\condabin`）。
- 本仓库的 `运行程序.bat` 会优先从 `PATH` 和常见安装目录自动定位 `conda.bat`；若你使用了非常规目录，可在脚本中手动指定 `CONDA_BAT` 路径。

### 安装步骤

#### 1) 创建并激活环境

```bash
conda create -n MinerU python=3.12 -y
conda activate MinerU
```

#### 2) 安装核心依赖

**必需依赖**（PDF处理、提取功能）：

```bash
pip install -U "mineru[core]"
pip install pandas openpyxl beautifulsoup4 python-docx lxml
```

**可选依赖**（章节提取功能）：

```bash
pip install requests python-dotenv
```

**说明**：

- 不安装 `pandas`、`openpyxl`：表格只保存JPG，不生成Excel
- 不安装 `python-docx`：不生成Word文档
- 不安装 `requests`、`python-dotenv`：章节提取功能不可用（仅正则表达式，90%成功率）
- 其他功能不受影响

**环境重置**（若安装出错）：

```bash
conda deactivate
conda env remove -n MinerU
conda clean -a
pip cache purge
# 然后重新从步骤1开始
```

#### 3) 安装 PyTorch（CPU / GPU 二选一）

MinerU 运行时需要 PyTorch，未安装或损坏会导致模型下载/推理失败。

- CPU 环境（无 NVIDIA/CUDA 或希望强制使用 CPU）：

  ```bash
  conda install pytorch torchvision torchaudio cpuonly -c pytorch
  ```
- GPU 环境（示例为 CUDA 12.1，如有不同请改为实际版本）：

  ```bash
  conda install pytorch torchvision torchaudio pytorch-cuda=12.1 -c pytorch -c nvidia
  ```

提示：

- 使用 `nvidia-smi` 查看驱动支持的最高 CUDA 版本；
- 参照 PyTorch 表格选择匹配的 `pytorch-cuda` 版本；
- 若冲突，先卸载旧版 `torch/torchvision/torchaudio` 再安装。

#### 4) 下载模型文件

根据网络环境选择不同源：

```bash
# 国内网络（推荐）：
mineru-models-download --source modelscope --model_type pipeline

# 国外/公网：
mineru-models-download --source hf --model_type pipeline

# 查看更多可用源：
mineru-models-download --help
```

首次下载会在用户主目录创建 `mineru.json`，其中包含 `models-dir.pipeline` 路径。

#### 5) 验证安装

```bash
mineru --help
```

## 🚀 安装后配置

### 章节提取功能配置（可选）

#### 智能章节提取策略说明

本工具采用**三层智能提取策略**，自动选择最优方案：

**第 1 层：正则表达式提取**（主力，90%成功率）

- ⚡ 速度：毫秒级
- 💰 成本：免费
- 🎯 准确：不修改原文
- 📊 覆盖大部分标准论文

**第 2 层：LLM 轻量级分类**（补充，提升到 98%）

- 🔍 只发送未识别的标题给 LLM（~300-500 tokens）
- 🤖 LLM 分类标题类型，然后用正则提取内容
- ⚡ 速度快（1-2秒），成本低（~¥0.0005/篇）
- 💡 保留原文内容，不修改

**第 3 层：LLM 全量提取**（备用，极少触发）

- 📄 发送完整文档给 LLM（~25,000 tokens）
- 🤖 LLM 提取所有章节内容
- ⏱️ 速度慢（10-30秒），成本高（~¥0.002/篇）
- ⚠️ 可能修改格式

#### 1) 创建配置文件

在项目根目录创建 `.env` 文件（或复制 `.env.example` 并重命名）：

```env
# DeepSeek API（成本低，速度快）
DEEPSEEK_API_KEY=sk-your_deepseek_api_key_here
```

#### 2) 获取 API Key

- **Deepseek**: https://platform.deepseek.com/

  - 注册账户
  - 充值（最低¥10）
  - 创建 API Key

---

## 💻 启动和使用

### 启动图形界面

双击根目录下的 `运行程序.bat`

### 基本使用流程

#### 模式1: 完整处理（推荐）

1. 将PDF文件放入 `input/` 文件夹
2. 在GUI中选择处理选项：
   - ✅ 提取文字 (Markdown)
   - ✅ 提取公式 (LaTeX)
   - ✅ 提取图片（智能识别编号）
   - ✅ 提取表格 (Excel)
   - ✅ 提取论文章节（正则表达式 + LLM）
3. 点击 "▶ 开始处理"
4. 查看结果：
   - MinerU原始输出：`output/raw/`
   - 提取结果：`output/extract/[PDF名称]/`
     - `Figure/` - 图片文件
     - `Tables/` - 表格（JPG + Excel）
     - `Formula/` - 公式
     - `Sections/` - 论文章节
     - `Word/` - 图表汇总Word文档

#### 模式2: 仅提取

适用于已经运行过MinerU，只想重新提取内容的情况：

1. 选择"仅提取（从已有raw文件夹提取）"
2. 勾选需要提取的内容
3. 点击 "▶ 开始处理"

### 输出结构

```
output/
├── raw/                          # MinerU原始输出
│   └── [PDF名称]/
│       └── auto/
│           ├── [PDF名称].md      # 完整markdown
│           ├── images/           # 所有图片
│           └── *_content_list.json
│
└── extract/                      # 智能提取结果
    └── [PDF名称]/
        ├── [PDF名称].md          # 完整文本（修复图片路径）
        ├── Figure/               # 图片（智能命名）
        │   ├── Fig.1.jpg
        │   ├── Fig.2.jpg
        │   └── image_mapping.json
        ├── Tables/               # 表格
        │   ├── Table_1.jpg
        │   ├── Table_1.xlsx
        │   ├── Table_2.jpg
        │   └── Table_2.xlsx
        ├── Formula/              # 公式
        │   ├── formula_1.jpg
        │   └── [PDF名称]_formula.md
        ├── Sections/             # 论文章节
        │   ├── Abstract.md
        │   ├── Introduction.md
        │   ├── Methods.md
        │   ├── Results & Discussion.md
        │   └── Conclusion.md
        └── Word/                 # Word文档
            ├── [PDF名称]_图表.docx
            └── [PDF名称]_图表汇总.md
```

## 常见问题

### 环境问题

- `conda: command not found` → 安装 Anaconda/Miniconda
- `mineru: command not found` → `conda activate MinerU` 后重新安装
- `ImportError: numpy/torch` → 重新安装核心依赖或重建环境
- GUI 缺组件 → `pip install python-docx tkinter`

### 网络问题

pip 安装超时：

```bash
pip install -U "mineru[core]" -i https://mirrors.aliyun.com/pypi/simple --timeout 120
# 或
pip install -U "mineru[core]" -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 运行与模型问题

- `mineru.json` 位置：`C:\Users\<用户名>\mineru.json`
- 如果模型下载失败：更换 `--source` 或重试；确认 PyTorch 已正确安装
- PyTorch `FutureWarning`（`weights_only=False`）为提示信息，可忽略

### 章节提取问题

**Q: 章节提取功能不可用？**

- 检查是否安装了 `requests` 和 `python-dotenv`
- 不安装也可用（仅第 1 层正则表达式，90%成功率）

**Q: LLM 调用失败？**

- 检查 `.env` 文件是否在项目根目录
- 检查 API Key 格式是否正确（Deepseek 以 `sk-` 开头）
- 检查网络连接
- Deepseek：确认账户有余额

**Q: 为什么没有触发 LLM？**

- 这是正常现象！90% 的标准论文第 1 层（正则表达式）就能完美提取
- 只在发现质量问题或未识别标题时才触发第 2/3 层

**Q: 控制台显示"LLM 分类未识别的标题"是什么意思？**

- 这是第 2 层（轻量级分类）在工作
- 发现了正则表达式未识别的标题（如 `# 2. Classification...`）
- LLM 只分类标题类型，不提取内容，成本极低（~¥0.0005）

**Q: 什么时候会触发第 3 层（全量提取）？**

- 第 1 层完全失败（未提取到任何章节）
- 缺少关键章节（Abstract、Introduction、Methods 等）
- 章节内容过短（< 100 字符）
- 章节数量异常（< 2 个）
- 实际触发率：< 2%

**Q: 章节内容被修改了？**

- 第 1 层和第 2 层：不修改原文，直接从 markdown 提取
- 第 3 层：LLM 可能调整格式或修正错误
- 建议对比原文检查，或从完整 markdown 手动复制

**Q: 提取的章节不完整？**

- 检查控制台日志，查看使用了哪一层
- 如果是第 1 层，可能触发第 2 层补充
- 如果是第 2 层，可能触发第 3 层
- 可调整质量检查阈值（参见 README 高级配置）
- 可手动从完整 markdown 复制

**Q: Methods 章节没有提取？**

- 第 1 层支持识别 Materials、Experimental、Methodology 等变体
- 如果标题不标准（如 `# 2. Classification...`），会触发第 2 层分类
- 如果仍未识别，会触发第 3 层全量提取

**Q: 如何查看使用了哪一层？**

- 查看控制台日志：
  - `🔄 使用正则表达式提取章节...` → 第 1 层
  - `🔍 发现 X 个未识别的章节标题，尝试使用 LLM 分类...` → 第 2 层
  - `⚠️ 质量检查未通过...` → 第 3 层

## 环境要求

### 最低要求

- Python 3.10–3.13（推荐 3.12）
- Anaconda/Miniconda
- 内存 8GB+（CPU 模式建议 16GB+）
- 存储 5GB+

### 可选配置

- GPU 模式：NVIDIA 显卡 + CUDA（加速处理）
- LLM功能：Deepseek API Key（提高章节提取成功率）
